from flask import Flask, request
from twilio.twiml.messaging_response import MessagingResponse
import random

app = Flask(__name__)

# List of random Hadiths
hadiths = [
    "قال رسول الله صلى الله عليه وسلم: «ما يُصِيبُ المُسْلِمَ، مِن نَصَبٍ ولَا وصَبٍ، ولَا هَمٍّ ولَا حُزْنٍ ولَا أذًى ولَا غَمٍّ، حتَّى الشَّوْكَةِ يُشَاكُهَا، إلَّا كَفَّرَ اللَّهُ بهَا مِن خَطَايَاهُ». المصدر: البخاري",
    "قال رسول الله صلى الله عليه وسلم: «إنَّ اللَّهَ قالَ: مَن عادَى لي وَلِيًّا فقَدْ آذَنْتُهُ بالحَرْبِ، وما تَقَرَّبَ إلَيَّ عَبْدِي بشَيءٍ أحَبَّ إلَيَّ ممَّا افْتَرَضْتُ عليه، وما يَزالُ عَبْدِي يَتَقَرَّبُ إلَيَّ بالنَّوافِلِ حتَّى أُحِبَّهُ، فإذا أحْبَبْتُهُ، كُنْتُ سَمْعَهُ الَّذي يَسْمَعُ به، وبَصَرَهُ الَّذي يُبْصِرُ به، ويَدَهُ الَّتي يَبطِشُ بها، ورِجْلَهُ الَّتي يَمْشِي بها، وإنْ سَأَلَنِي لَأُعْطِيَنَّهُ، ولَئِنِ اسْتَعاذَنِي لَأُعِيذَنَّهُ، وما تَرَدَّدْتُ عن شَيءٍ أنا فاعِلُهُ تَرَدُّدِي عن نَفْسِ المُؤْمِنِ؛ يَكْرَهُ المَوْتَ، وأنا أكْرَهُ مَساءَتَهُ». المصدر: البخاري",
    "قال رسول الله صلى الله عليه وسلم: «مَنْ سأَلَ اللَّه تَعَالَى الشَّهَادةَ بِصِدْقٍ بلَّغهُ اللهُ منَازِلَ الشُّهَداءِ وإنْ ماتَ على فِراشِهِ». المصدر: مسلم",
    "قال رسول الله صلى الله عليه وسلم: «الْمُؤْمِنُ القَوِيُّ خَيْرٌ وَأَحَبُّ إلى اللهِ مِنَ المُؤْمِنِ الضَّعِيفِ، وفي كُلٍّ خَيْرٌ. احْرِصْ علَى ما يَنْفَعُكَ، وَاسْتَعِنْ باللَّهِ وَلَا تَعْجِزْ، وإنْ أَصَابَكَ شَيءٌ، فلا تَقُلْ: لو أَنِّي فَعَلْتُ كانَ كَذَا وَكَذَا، وَلَكِنْ قُلْ: قَدَرُ اللهِ وَما شَاءَ فَعَلَ؛ فإنَّ (لو) تَفْتَحُ عَمَلَ الشَّيْطَانِ». المصدر: صحيح مسلم",
    "قال رسول الله صلى الله عليه وسلم: «إنَّ اللَّهَ كَتَبَ كِتابًا قَبْلَ أنْ يَخْلُقَ الخَلْقَ: إنَّ رَحْمَتي سَبَقَتْ غَضَبِي، فَهو مَكْتُوبٌ عِنْدَهُ فَوْقَ العَرْشِ». المصدر: صحيح البخاري",
    "قال رسول الله صلى الله عليه وسلم: «خَيْرُكُمْ مَن تَعَلَّمَ القُرْآنَ وعَلَّمَهُ». قالَ: وأَقْرَأَ أبو عبدِ الرَّحْمَنِ في إمْرَةِ عُثْمانَ، حتَّى كانَ الحَجَّاجُ قالَ: وذاكَ الذي أقْعَدَنِي مَقْعَدِي هذا. المصدر: صحيح البخاري",
    "قال عُمَرُ: أَمَا إنَّ نَبِيَّكُمْ صَلَّى اللَّهُ عليه وَسَلَّمَ قدْ قالَ: إنَّ اللَّهَ يَرْفَعُ بهذا الكِتَابِ أَقْوَامًا، وَيَضَعُ به آخَرِينَ. المصدر: صحيح مسلم",
    "قال رسول الله صلى الله عليه وسلم: «الآيَتانِ مِن آخِرِ سُورَةِ البَقَرَةِ، مَن قَرَأَهُما في لَيْلَةٍ كَفَتاهُ». المصدر: صحيح البخاري"
]

@app.route("/", methods=["POST"])
def bot():
    # Get the user input from the message body
    user_msg = request.values.get('Body', '').lower()

    # Create a response object using Twilio's MessagingResponse
    response = MessagingResponse()

    # Check if the user sent "اخبرني حديث" or "أخبرني حديث"
    if "اخبرني حديث" in user_msg or "أخبرني حديث" in user_msg:
        # Send a random hadith
        response.message(random.choice(hadiths))
    else:
        # Default response for other messages
        response.message("انت تقصد ان تقول اخبرني حديث")

    return str(response)

if __name__ == "__main__":
    # Run the app on host '0.0.0.0' and port 8080
    app.run(host="0.0.0.0", port=8080)
